<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 8.5.2" />
<title>Development</title>
<style type="text/css">
      li>p {
          display: inline;
      }
      body {
        margin-left: 12.5em;
        margin-right: 2em;
        padding: 0;
        background-color: #fff;
	color: black;
      }
      div.paper {
        background-color: #fff;
	color: black;
        margin: 1em;
        /*margin-left: 12.5em;*/
      }
      iframe {
        background-color: #aaa;
      }
      div.content {
        padding: 1em;
        padding-right: 3em;
        padding-left: 2em;
        max-width: 45em;
      }
      div.graphic {
        position: absolute;
        position: fixed;
        color: #fff;
        width:  297px;
        height: 230px;
        bottom: 0;
        left: 0;
        text-align: right;
        padding-bottom: 1em;
      }
      p {
        line-height: 1.2em;
      }
      h1 {
        margin-top: 0em;
      }
      h1, h2, h3, h4{
        color: #112266;
      }
      h1 {
        font-size: 2em;
      }
      h2 {
        font-size: 1.5em;
      }
      h3 {
        font-size: 1.2em;
      }
      h4 {
        font-size: 1.0em;
      }
      dl {
        margin-top: 1em;
        margin-bottom: 1em;
      }

      div.expander {
        border: 1px solid #bbb;
      }
      div.expander_title {
        /*border-bottom: 0px solid #aaa;*/
      }
      div.expander_content {
        margin-left: 2em;
        display: none;
        padding-bottom: 1em;
      }
      div.expander_content dl{
        margin: 0;
        padding: 0;
      }


      table th {
        font-weight: normal;
        background-color: #ccc;
        text-align: left;
      }
      span.component {
        background-color: #060;
        padding-left: 0.5em;
        padding-top: 0.1em;
        padding-bottom: 0.1em;
        display: block;
        float: left;
        overflow: hidden;
        width: 4em;
        color: white;
        border: 1px solid gray;
        border: 1px solid white;
        clear: both;
      }
      span.type {
        display: block;
        background-color: #006;
        padding-left: 0.5em;
        clear: both;
        padding-top: 0.1em;
        padding-bottom: 0.1em;
        float: left;
        overflow: hidden;
        width: 4em;
        color: white;
        border: 1px solid white;
      }

      .nopad {
        margin :0;
        padding:0;
      }

      td.component {
        background-color: #060;
        padding-left: 0.5em;
        padding-top: 0.1em;
        padding-bottom: 0.1em;
        overflow: hidden;
        width: 4em;
        color: white;
        border: 1px solid white;
      }
      td.type {
        background-color: #006;
        padding-left: 0.5em;
        padding-top: 0.1em;
        padding-bottom: 0.1em;
        overflow: hidden;
        width: 4em;
        color: white;
        border: 1px solid white;
      }
      span.spacer {
        float: left;
        display: block;
        overflow: hidden;
        width: 0.2em;
      }
      span.name {
        width: 100%;
        display: block;
        overflow: hidden;
        border-top: 1px solid #ccc;
      }
      span.string {
        color: #060;
      }
      span.function {
        color: #006;
      }
      span.paren {
        color: #555;
      }
      span.NULL {
        color: #555;
      }
      pre.authors {
        font-size: 100%;
        font-family: FreeSans, Verdana, sans-serif;
        position: relative;
        top: -2em;
      }
      img.BablFish {
         float: right;
         position: relative;
         top: -8px;
         border: none;
      }
      td.op_name {
          padding-top: 2.5em;
          padding-bottom: 1.0em;
          font-weight: bold;
          font-size: 120%;
      }
      td.op_description {
          padding-bottom: 1em;
      }
      td.prop_type {
          color: gray;
          font-style: italic;
      }
      td.prop_name {
          font-weight: bold;
      }
      td.prop_blurb {
          padding-bottom: 0.5em;
      }
      @media screen {
        body {
          font-family: FreeSans, Verdana, sans-serif;
          max-width: 45em;
        }
        a {
          text-decoration: none;
        }
        pre {
          overflow: auto;
        }
        h1 {
            display: none;
        }

        div#toc {
          background-color: #333;
          position: absolute;
          position: fixed;
          width: 12em;
          top: 0;
          left: 0;
          z-index: 2;
          height: 100%;
          overflow: auto;
          float: left;
          padding-top: 0.5em;
        }
        div#toc ul {
          padding-top: 0em;
          padding-left: 0em;
          margin: 0;
        }
        div#toc li {
          display: block;
          padding-right: 1em;
        }
        div#toc li a,
        div#toc div a{
          display: block;
          padding-left: 1em;
          padding-right: 1em;
          color: #fff;
        }
        div#toc li a:hover,
        div#toc div a:hover{
          color: #fff;
          background-color: #445;
        }
        div#toc li a:active,
        div#toc div a:active{
          color: #000;
          background-color: #445;
        }
        div#toc .toclevel1 {
          padding-top: 0.5em;
          padding-left: 0em;
        }
        div#toc .toclevel2 {
          padding-left: 1em;
        }
        #toctitle {
            display: none;
        }
        div.paper {
          max-width: 45em;
          -moz-border-radius: 1em;
        }
        div.content {
        }
        div.graphic {
           /*background: url("gallery/data/gegl.png");
           background-repeat: no-repeat;
           z-index: 1;*/
        }
        div.print {
          display: none;
        }
        ul.crucible {margin:0; padding:0}
        ul.crucible li{display: inline;}
      }

      h2#gegl {
          display: none;
      }

      @media print {
        body {
          background-color: none;
          font-family: FreeSans, Verdana, sans-serif;
        }
        a, em {
          /* XXX: work-around for rendering bug, should investigate whether
           * this issue is fixed in the latest gecko
           */
          padding-right: 3em;
          padding-left: 1em;
        }
        a {
          text-decoration: none;
        }

        div#toc ul {
          padding-left: 0em;
          float: right;
          margin: 0;
        }
        div#toc li {
          display: block;
          padding-right: 1em;
        }
        div#toc li a{
          display: block;
          padding-left: 1em;
          padding-right: 1em;
          color: #fff;
        }
        div#toc li a:hover {
          color: #fff;
          background-color: #333;
        }
        div#toc ul {
          padding-left: 0em;
          float: none;
          margin: 0;
          margin-left: 1em;
        }
        div#toc {
          position: absolute;
          width: 200px;
          top: 0;
          left: 2em;
          padding-top: 2em;
          z-index: 2;
        }
        div#toc ul {
          margin-left: 0;
        }
        div#toc li a {
          color : #000;
        }
        div#toc h2 {
          margin: 0;
          padding: 0;
        }
        h1 {
          margin-left: -0.75em;
        }
        h2 {
          padding-top: 4em;
          margin-left: -1em;
        }
        h3 {
          padding-top: 4em;
          margin-left: -1em;
        }
        span.component {
          background-color: #7f7;
          color: black;
        }
        span.type {
          background-color: #aaf;
          color: black;
        }
        table th {
          font-weight: bold;
        }
        div.print_title {
          position: absolute;
          top: 3em;
          padding-left: 2em;
          margin-left: 280px;
        }
        div.paper {
          padding-top: 4em;
        }
        div.graphic {
          display: none;
          background-color: #bbf;
          height: 100%;
        }
        div.graphic img {
          position: absolute;
          bottom: 0;
          left: 0;
        }
        div.screen {
          display: none;
        }
      }
</style>
<script type="text/javascript">
/*<![CDATA[*/
window.onload = function(){asciidoc.footnotes(); asciidoc.toc(2);}
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([2-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  var cont = document.getElementById("content");
  var noteholder = document.getElementById("footnotes");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      // Use [\s\S] in place of . so multi-line matches work.
      // Because JavaScript has no s (dotall) regex flag.
      note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      spans[i].innerHTML =
        "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
        "' title='View footnote' class='footnote'>" + n + "</a>]";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
}

}
/*]]>*/
</script>
</head>
<body>
<div id="header">
<h1>Development</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="imageblock">
<div class="content">
<img src="images/GEGL.png" alt="GEGL" />
</div>
</div>
<div class="paragraph"><p><strong>Development</strong></p></div>
<div class="paragraph"><p>This document describes some handy things to know when developing the gegl internals.
Parts of it is copy-paste of emails on the gegl developer list.</p></div>
</div>
</div>
<h2 id="_setting_up">Setting up</h2>
<div class="sectionbody">
<h3 id="_ubuntu_8_10">Ubuntu 8.10</h3>
<div class="paragraph"><p>Setup instructions for Ubuntu 8.10 Intrepid Ibex</p></div>
<div class="paragraph"><p>To install the mandatory dependencies:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ sudo apt-get install libtool automake glib libglib2.0-dev libpng12-dev libgtk2.0-dev git</tt></pre>
</div></div>
<div class="paragraph"><p>Some of the other dependencies:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ sudo apt-get install asciidoc enscript libjpeg62 libopenraw graphviz-dev</tt></pre>
</div></div>
<div class="paragraph"><p>For running gegl the GEGL_PATH, which is used for dynamically loading the
operations, has to be set:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ export GEGL_PATH=~/Dev/gegl-dev/operations/</tt></pre>
</div></div>
<h3 id="_babl">BABL</h3>
<div class="paragraph"><p>When using a development version of babl, gegl has to know from where to get it.
This is done by setting the BABL_LIBS environment variable before (or during
as shown below) running gegl&#8217;s autogen.sh:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ ./autogen.sh BABL_LIBS=~/Dev/babl/babl/.libs/libbabl-0.0.so.0.23.0 CFLAGS="-O0"</tt></pre>
</div></div>
<div class="paragraph"><p>Then when running the program, the babl library automatically loads extensions
that are either located in the BABL_HOME directory or in the default installation
directory, in mentioned order of preference.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ export BABL_HOME=~/Dev/babl/extensions</tt></pre>
</div></div>
<h3 id="_netbeans_6_5">Netbeans 6.5</h3>
<div class="paragraph"><p>There are some key points to consider when setting up GEGL in an IDE
(tested on Netbeans):</p></div>
<div class="ulist"><ul>
<li>
<p>
have to configure the IDE to use the autogen.sh as configure script
</p>
</li>
<li>
<p>
normally have to use gegl/bin/.libs/gegl as the executable,
 not gegl/bin/gegl which is a script.
</p>
</li>
<li>
<p>
in some (?) case has to use bin/.libs/lt-gegl as the executable, which is some
 kind of relinked gegl binary
</p>
</li>
</ul></div>
</div>
<h2 id="_debugging">Debugging</h2>
<div class="sectionbody">
<div class="paragraph"><p>By default gegl and babl uses the flag -g for debug instrumentation, but however
it doesn&#8217;t use the -O0 flag for turning off optimisations. This leads to unexpected
jumps in the code when stepping in a debugger. You have to feed this flag to
autogen:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ ./autogen.sh CFLAGS="-O0"
$ make</tt></pre>
</div></div>
<h3 id="_debug_output">Debug output</h3>
<div class="paragraph"><p>GEGL has built in mechanisms for logging debug information.</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>GEGL_NOTE (CACHE, "foo %s", bar);
GEGL_TIMESTAMP(PROCESSOR);
GEGL_MARK()</tt></pre>
</div></div>
<div class="paragraph"><p>Where CACHE and PROCESSOR is used the following logging domains are available:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>PROCESS, CACHE, BUFFER_LOAD, BUFFER_SAVE, TILE_BACKEND and PROCESSOR</tt></pre>
</div></div>
<div class="paragraph"><p>Actual printing of these can be enabled by setting the GEGL_DEBUG
environment variable like:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>GEGL_DEBUG=processor,cache</tt></pre>
</div></div>
<div class="paragraph"><p>or even</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>GEGL_DEBUG=all</tt></pre>
</div></div>
<div class="paragraph"><p>There are also a few functions that are useful as you debug from
within a debugger such as GDB. In GDB for example, you call a function
interactively in the prompt, while a breakpoint is hit for example, by
typing</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>print function_name(args)</tt></pre>
</div></div>
<div class="paragraph"><p>Some useful functions are:</p></div>
<div class="ulist"><ul>
<li>
<p>
<strong>gegl_dot_node_to_png_default()</strong> Writes a PNG to /tmp/node.png with
  the dependency graph for the passed node
</p>
</li>
<li>
<p>
<strong>gegl_node_dump_depends_on()</strong> Dumps to stdout the nodes that the
  passed node depends on. With this you can work yourself backwards in
  a dependency graph.
</p>
</li>
<li>
<p>
<strong>gegl_node_get_debug_name()</strong> Prints a debug string representation of
   a node.
</p>
</li>
</ul></div>
<h3 id="_graphviz_export">Graphviz export</h3>
<div class="paragraph"><p>The gegl library has a utility that permits to export the DAG into a graphviz
format. Graphviz is a library that converts graph descriptions in textual format
into an image. See <a href="http://www.graphviz.org/">graphviz website</a></p></div>
<div class="paragraph"><p>It is done using:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>#include "../gegl/gegl-dot.h"
/* for printing the dot output, note that gegl_node is a GeglNode pointer */
gchar *dot_output = gegl_to_dot( gegl_node );
printf( "%s\n", dot_output );
g_free( dot_output );</tt></pre>
</div></div>
<div class="paragraph"><p>For creating the graph image:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>$ gegl --file gaussian-blur.xml --output out.png | dot -Tpng &gt; gb.png</tt></pre>
</div></div>
<div class="paragraph"><p>This is the gaussian-blur.xml file:</p></div>
<div class="literalblock">
<div class="content">
<pre><tt>&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;gegl&gt;
       &lt;node operation='gegl:gaussian-blur'&gt;
               &lt;params&gt;
                       &lt;param name='std-dev-x'&gt;0.999&lt;/param&gt;
                       &lt;param name='std-dev-y'&gt;0.999&lt;/param&gt;
               &lt;/params&gt;
       &lt;/node&gt;
       &lt;node operation='gegl:load'&gt;
               &lt;params&gt;
                       &lt;param name='path'&gt;in.png&lt;/param&gt;
               &lt;/params&gt;
       &lt;/node&gt;
&lt;/gegl&gt;</tt></pre>
</div></div>
<div class="paragraph"><p><a href="images/gaussian-blur-graph.png">Resulting graph</a>.</p></div>
<div class="paragraph"><p>You can also just call the function gegl_dot_node_to_png() directly
from within gdb to show the graphviz graph of a node and its
dependencies.</p></div>
</div>
<h2 id="_tests">Tests</h2>
<div class="sectionbody">
<div class="paragraph"><p>There are regression tests in the subfolder "tests". These are run using:
 make check</p></div>
</div>
<h2 id="_documentation">Documentation</h2>
<div class="sectionbody">
<div class="paragraph"><p>This document describes how to document GEGL using it&#8217;s build system.</p></div>
<div class="paragraph"><p>There are three utilities used:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
<a href="http://www.methods.co.nz/asciidoc/">asciidoc</a> - used for generating html from text files
</p>
</li>
<li>
<p>
<a href="http://www.codento.com/people/mtr/genscript/">enscript</a> - used for converting source files (.c/.h) to html
</p>
</li>
<li>
<p>
a home-made ruby script - used for generating api documentation (not yet documented here)
</p>
</li>
</ol></div>
<div class="paragraph"><p>All documentation resources are placed in /doc and the generation is controlled by the file Makefile.am</p></div>
<h3 id="_asciidoc">asciidoc</h3>
<div class="paragraph"><p>This example will show how this howto was added.</p></div>
<div class="ulist"><ul>
<li>
<p>
Add in <tt>Makefile.am</tt> a new target named <tt>documentation-howto.html</tt> in
the existing list of html files to generate:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>if HAVE_ASCIIDOC
      HTML_FILES += index.html documentation-howto.html
endif</tt></pre>
</div></div>
</li>
<li>
<p>
Add in <tt>Makefile.am</tt> the target:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>documentation-howto.html: documentation-howto.txt
if HAVE_ASCIIDOC
       @echo "HTML: $@"
       cp $&lt; $@
       $(ASCIIDOC) --unsafe  -o $@ -a stylesdir=`pwd` -a toc -a theme=gegl -a quirks! $&lt;
else
       @echo "*** asciidoc must be available in order to make dist"
       @false
endif</tt></pre>
</div></div>
</li>
<li>
<p>
Create a new <tt>documentation-howto.txt</tt> file with this content:
</p>
<div class="literalblock">
<div class="content">
<pre><tt>== Documentation howto</tt></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><tt>This document describes how to document GEGL using it's build system.</tt></pre>
</div></div>
</li>
<li>
<p>
Type <tt>make</tt> and the <tt>documentation-howto.txt</tt> will be converted into <tt>documentation-howto.html</tt>
</p>
</li>
</ul></div>
<h3 id="_enscript">enscript</h3>
<div class="paragraph"><p>TODO
This example will show how a new c/h file is converted into html using enscript</p></div>
</div>
<h2 id="_inheritance_tree">Inheritance tree</h2>
<div class="sectionbody">
<div class="paragraph"><p>Here is an automatically generated inheritance tree of the gobjects used by gegl:
<a href="images/inheritance.png">GEGL inheritance tree</a>
Note that the operations are also gobjects, but they are not included in the inheritance tree.</p></div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated 2010-02-07 14:43:55 BST
</div>
</div>
</body>
</html>
